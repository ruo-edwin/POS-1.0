<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Superadmin Dashboard | SmartPOS</title>

  <!-- Stripe Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --stripe-primary: #635bff;
      --stripe-dark: #1a1f36;
      --stripe-light-bg: #f6f9fc;
      --card-border: #e3e8ee;
      --badge-trial: #00bcd4;
      --badge-active: #28c76f;
      --badge-expired: #ffa726;
      --badge-suspended: #ef5350;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--stripe-light-bg);
      margin: 0;
      padding: 0;
      color: var(--stripe-dark);
    }

    .dashboard-title {
      font-size: 2.1rem;
      font-weight: 700;
      text-align: center;
      margin-top: 40px;
      color: var(--stripe-dark);
      letter-spacing: -0.5px;
    }

    .main-card {
      background: #ffffff;
      max-width: 1150px;
      margin: 40px auto;
      padding: 30px;
      border-radius: 14px;
      border: 1px solid var(--card-border);
      box-shadow: 0 10px 25px rgba(0,0,0,0.07);
    }

    .table-container {
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--card-border);
    }

    thead {
      background: #f1f4f9;
    }

    thead th {
      font-weight: 600;
      font-size: 0.85rem;
      padding: 14px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      color: #3b4256;
    }

    tbody td {
      padding: 14px;
      font-size: 0.92rem;
      color: #2a2f45;
    }

    tbody tr:hover {
      background: #f9fbff;
      transition: 0.25s;
    }

    .badge-status {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
    }

    .trial { background: var(--badge-trial); }
    .active { background: var(--badge-active); }
    .expired { background: var(--badge-expired); color: black !important; }
    .suspended { background: var(--badge-suspended); }

    .action-btn {
      padding: 6px 12px !important;
      border-radius: 6px !important;
      font-size: 0.82rem !important;
      font-weight: 600;
      border: none;
    }

    .btn-success { background: var(--badge-active) !important; }
    .btn-primary { background: var(--stripe-primary) !important; }
    .btn-danger { background: var(--badge-suspended) !important; }
    .btn-warning { background: var(--badge-expired) !important; color: #1a1f36 !important; }
  </style>
</head>

<body>

  <h2 class="dashboard-title">Superadmin Client Management</h2>

  <div class="main-card">
    <div class="table-container">
      <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th>Business</th>
            <th>Username</th>
            <th>Phone</th>
            <th>Last Login</th>
            <th>Subscription</th>
            <th>Days Left</th>
            <th>Status</th>
            <th style="width: 260px;">Actions</th>
          </tr>
        </thead>

        <tbody id="clientTable"></tbody>
      </table>
    </div>
  </div>

  <script>
    function formatLastLogin(timestamp) {
      if (!timestamp) return "â€”";
      const d = new Date(timestamp);
      return d.toLocaleString("en-GB", {
        year: "numeric",
        month: "short",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit"
      });
    }

    async function loadClients() {
      const response = await fetch("/superadmin/get_all_clients");
      const data = await response.json();
      const table = document.getElementById("clientTable");
      table.innerHTML = "";

      data.forEach(client => {
        const statusClass = client.subscription_status;

        table.innerHTML += `
          <tr>
            <td>${client.business_name}</td>
            <td>${client.username}</td>
            <td>${client.phone || "-"}</td>
            <td>${formatLastLogin(client.last_login)}</td>

            <td>
              <span class="badge-status ${statusClass}">
                ${client.subscription_status.toUpperCase()}
              </span>
            </td>

            <td>${client.days_left}</td>
            <td>${client.is_active ? "Active" : "Inactive"}</td>

            <td>
              ${
                ["trial", "expired"].includes(client.subscription_status)
                ? `<button class="btn btn-success action-btn" onclick="activate(${client.business_id})">Activate</button>`
                : ``
              }

              ${
                client.subscription_status === "active"
                ? `<button class="btn btn-primary action-btn" onclick="renew(${client.business_id})">Renew 30 Days</button>`
                : ``
              }

              ${
                client.subscription_status !== "suspended"
                ? `<button class="btn btn-danger action-btn" onclick="suspend(${client.business_id})">Suspend</button>`
                : `<button class="btn btn-warning action-btn" onclick="reactivate(${client.business_id})">Reactivate</button>`
              }
            </td>
          </tr>
        `;
      });
    }

    async function activate(id) {
      await fetch(`/superadmin/activate/${id}`, { method: "POST" });
      loadClients();
    }

    async function renew(id) {
      await fetch(`/superadmin/renew/${id}`, { method: "POST" });
      loadClients();
    }

    async function suspend(id) {
      await fetch(`/superadmin/suspend/${id}`, { method: "POST" });
      loadClients();
    }

    async function reactivate(id) {
      await fetch(`/superadmin/reactivate/${id}`, { method: "POST" });
      loadClients();
    }

    loadClients();
  </script>

</body>
</html>
